<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Vector-borne disease models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Vector-borne disease models in R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session1_intro_to_mathematical_modelling/session1_intro_to_mathematical_modelling.html" class="sidebar-item-text sidebar-link">Introduction to Mathematical Modelling</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session2_differential_equations_in_r/session2_differential_equations_in_r.html" class="sidebar-item-text sidebar-link">Differential Equations in R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session3_writing_a_model_to_suit_the_infectious_agent/session3_writing_a_model_to_suit_the_infectious_agent.html" class="sidebar-item-text sidebar-link">Designing a model to suit the pathogen</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session4_covid_thailand_seir_model/session4_covid_thailand_seir_model.html" class="sidebar-item-text sidebar-link">Fitting models in R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session5_fitting_models_in_r/session5_fitting_models_in_r.html" class="sidebar-item-text sidebar-link">COVID-19 Modelling in R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session7_vector_borne_modelling/session7_vector_borne_modelling.html" class="sidebar-item-text sidebar-link">Vector-borne disease modelling</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../session8_vector_borne_modelling_in_r/session8_vector_borne_modelling_in_r.html" class="sidebar-item-text sidebar-link active">Vector-borne disease models in R</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#setting-up-your-system" id="toc-setting-up-your-system" class="nav-link" data-scroll-target="#setting-up-your-system">Setting up your system</a></li>
  <li><a href="#save-your-new-file" id="toc-save-your-new-file" class="nav-link" data-scroll-target="#save-your-new-file">Save your new file</a></li>
  <li><a href="#set-working-directory" id="toc-set-working-directory" class="nav-link" data-scroll-target="#set-working-directory">Set working directory</a></li>
  <li><a href="#load-required-packages" id="toc-load-required-packages" class="nav-link" data-scroll-target="#load-required-packages">Load required packages</a></li>
  <li><a href="#part-1-a-model-for-dengue" id="toc-part-1-a-model-for-dengue" class="nav-link" data-scroll-target="#part-1-a-model-for-dengue"><strong>Part 1:</strong> A model for dengue</a>
  <ul class="collapse">
  <li><a href="#problem-description" id="toc-problem-description" class="nav-link" data-scroll-target="#problem-description">Problem description</a></li>
  <li><a href="#define-the-model-parameters-and-time-period-for-simulations" id="toc-define-the-model-parameters-and-time-period-for-simulations" class="nav-link" data-scroll-target="#define-the-model-parameters-and-time-period-for-simulations">Define the model parameters and time period for simulations</a></li>
  <li><a href="#set-up-the-initial-conditions" id="toc-set-up-the-initial-conditions" class="nav-link" data-scroll-target="#set-up-the-initial-conditions">Set up the initial conditions</a></li>
  <li><a href="#define-the-model-variables-also-known-as-compartments-or-states" id="toc-define-the-model-variables-also-known-as-compartments-or-states" class="nav-link" data-scroll-target="#define-the-model-variables-also-known-as-compartments-or-states">Define the model variables (also known as compartments or states)</a></li>
  <li><a href="#set-up-a-function-to-solve-the-equations" id="toc-set-up-a-function-to-solve-the-equations" class="nav-link" data-scroll-target="#set-up-a-function-to-solve-the-equations">Set up a function to solve the equations</a></li>
  <li><a href="#run-the-model-and-plot-the-results" id="toc-run-the-model-and-plot-the-results" class="nav-link" data-scroll-target="#run-the-model-and-plot-the-results">Run the model and plot the results</a></li>
  <li><a href="#comparing-to-published-dengue-incidence-data" id="toc-comparing-to-published-dengue-incidence-data" class="nav-link" data-scroll-target="#comparing-to-published-dengue-incidence-data">Comparing to published dengue incidence data</a></li>
  </ul></li>
  <li><a href="#part-1-solutions" id="toc-part-1-solutions" class="nav-link" data-scroll-target="#part-1-solutions"><strong>Part 1:</strong> Solutions</a></li>
  <li><a href="#part-2-adapting-the-model" id="toc-part-2-adapting-the-model" class="nav-link" data-scroll-target="#part-2-adapting-the-model"><strong>Part 2:</strong> Adapting the model</a>
  <ul class="collapse">
  <li><a href="#what-might-be-missing-from-our-dengue-model" id="toc-what-might-be-missing-from-our-dengue-model" class="nav-link" data-scroll-target="#what-might-be-missing-from-our-dengue-model">What might be missing from our dengue model?</a></li>
  <li><a href="#adding-another-compartment-to-our-model-diagram" id="toc-adding-another-compartment-to-our-model-diagram" class="nav-link" data-scroll-target="#adding-another-compartment-to-our-model-diagram">Adding another compartment to our model diagram</a></li>
  <li><a href="#adding-another-compartment-to-our-model-code" id="toc-adding-another-compartment-to-our-model-code" class="nav-link" data-scroll-target="#adding-another-compartment-to-our-model-code">Adding another compartment to our model code</a></li>
  </ul></li>
  <li><a href="#part-2-solutions" id="toc-part-2-solutions" class="nav-link" data-scroll-target="#part-2-solutions"><strong>Part 2:</strong> Solutions</a></li>
  <li><a href="#part-3-the-impact-of-seasonality" id="toc-part-3-the-impact-of-seasonality" class="nav-link" data-scroll-target="#part-3-the-impact-of-seasonality"><strong>Part 3:</strong> The impact of seasonality</a>
  <ul class="collapse">
  <li><a href="#adding-seasonality-to-the-model" id="toc-adding-seasonality-to-the-model" class="nav-link" data-scroll-target="#adding-seasonality-to-the-model">Adding seasonality to the model</a></li>
  </ul></li>
  <li><a href="#part-3-solutions" id="toc-part-3-solutions" class="nav-link" data-scroll-target="#part-3-solutions"><strong>Part 3:</strong> Solutions</a></li>
  <li><a href="#part-4-interventions" id="toc-part-4-interventions" class="nav-link" data-scroll-target="#part-4-interventions"><strong>Part 4:</strong> Interventions</a>
  <ul class="collapse">
  <li><a href="#interventions-to-control-dengue" id="toc-interventions-to-control-dengue" class="nav-link" data-scroll-target="#interventions-to-control-dengue">Interventions to control dengue</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Vector-borne disease models in R</h1>
<p class="author"></p><p><strong><em>SPARK short course ‘Mathematical Modelling of Infectious Diseases’, Indonesia, March 2023</em></strong><br>
<br>
<strong><em>Developed and presented by <a href="https://www.doherty.edu.au/people/patricia-trish-campbell">Trish Campbell</a>, The University of Melbourne at The Peter Doherty Institute for Infection and Immunity</em></strong></p><p></p>

</header>

<div class="cell">

</div>
<div class="cell" data-layout-align="center">
<style type="text/css">
textarea {
    width: 100%;
}

.line-block {
    line-height: 1.5em;
}

.line-block a {
    font-style: italic;
}
</style>
</div>
<section id="summary" class="level1 tabset tabset-pills tabset-fade">
<h1 class="tabset tabset-pills tabset-fade">Summary</h1>
<p>In this practical, we will code the vector-borne disease model developed in the previous session, adapt it to include more realism, explore how the behaviour of the system changes as some of our assumptions change and discuss how interventions might be included in the model.</p>
<p><strong>Part 1</strong> covers:</p>
<ul>
<li>Coding a model for dengue transmission</li>
<li>Running the model and plotting the results</li>
<li>Comparing the modelled output to published case numbers</li>
</ul>
<p><strong>Part 2</strong> covers:</p>
<ul>
<li>Adapting the model to include exposed compartments</li>
<li>Comparing the modelled output to published case numbers</li>
</ul>
<p><strong>Part 3</strong> covers:</p>
<ul>
<li>Adapting the model to include seasonality</li>
<li>Comparing the modelled output to published case numbers</li>
</ul>
<p><strong>Part 4</strong> covers:</p>
<ul>
<li>Identifying different interventions that could be used for dengue control</li>
<li>Identifying of the various model elements on which an intervention acts</li>
<li>Discuss in groups how the model would need to be adapted</li>
</ul>
<section id="setting-up-your-system" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-your-system">Setting up your system</h3>
<p>Before we begin developing a model, we need to set up our system.</p>
<p>As in previous sessions, we will start by creating a new file and writing a short description of your code to summarise its purpose for future users. Below is an example of such a description for this session. Open R studio, and then open the file <code>session8_vector_model.R</code> in the <code>\student_files</code> folder. Copy and paste the code chunk below (or write your own!) into your editor to start writing your own code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 1##</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a simple model of dengue. Results are then plotted.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="save-your-new-file" class="level3">
<h3 class="anchored" data-anchor-id="save-your-new-file">Save your new file</h3>
<p>We recommend saving your file in the <code>\student_materials</code> folder as you work through the practical session.</p>
</section>
<section id="set-working-directory" class="level3">
<h3 class="anchored" data-anchor-id="set-working-directory">Set working directory</h3>
<p>Remember to set your working directory. As in previous sessions, you can set the working directory by tabbing: Session/Set Working Directory/To Source Location</p>
<p>The better way is to re-use the RStudio Project you’ve been using so far (if you have one of them), and your working directory will be set automatically.</p>
</section>
<section id="load-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="load-required-packages">Load required packages</h3>
<p>Copy and paste the code below into your file to load the dplyr, deSolve and ggplot2 packages:</p>
<div class="cell" data-layout-align="center" data-warnings="false">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library imports</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> (<span class="fu">c</span>(<span class="st">"dplyr"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"deSolve"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"ggplot2"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-1-a-model-for-dengue" class="level2">
<h2 class="anchored" data-anchor-id="part-1-a-model-for-dengue"><strong>Part 1:</strong> A model for dengue</h2>
<section id="problem-description" class="level3">
<h3 class="anchored" data-anchor-id="problem-description">Problem description</h3>
<p>In the previous session, we developed a model for a mosquito-borne disease. Here, we will code that model in R and parameterise it using typical values applicable to dengue transmission.</p>
</section>
<section id="define-the-model-parameters-and-time-period-for-simulations" class="level3">
<h3 class="anchored" data-anchor-id="define-the-model-parameters-and-time-period-for-simulations">Define the model parameters and time period for simulations</h3>
<p>As we saw in previous sessions, model parameters must be estimated either from literature or from a model. In developing this model for dengue, we will use parameter values obtained from the following paper:</p>
<p>Ndii, M.Z., Hickson, R.I., Allingham, D. and Mercer, G.N., 2015. Modelling the transmission dynamics of dengue in the presence of <em>Wolbachia</em>. <em>Mathematical Biosciences</em>, 262, pp.157–166.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Parameter </th>
   <th style="text-align:left;"> Name </th>
   <th style="text-align:left;"> Value </th>
   <th style="text-align:left;"> Units </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Number of bites </td>
   <td style="text-align:left;"> bites </td>
   <td style="text-align:left;"> 0.63 </td>
   <td style="text-align:left;"> per mosquito per day </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Probability of transmission - mosquito to human </td>
   <td style="text-align:left;"> T_HM </td>
   <td style="text-align:left;"> 0.26 </td>
   <td style="text-align:left;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Probability of transmission - human to mosquito </td>
   <td style="text-align:left;"> T_MH </td>
   <td style="text-align:left;"> 0.26 </td>
   <td style="text-align:left;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Duration of infection - humans </td>
   <td style="text-align:left;"> infectious period </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> days </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mosquito birth and death rate </td>
   <td style="text-align:left;"> mu_M </td>
   <td style="text-align:left;"> 1/14 </td>
   <td style="text-align:left;"> per day </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Using the table of parameter names and values above, copy and paste the following code chunk into your editor and complete the code by entering the <span style="color: blue">VALUE, NAME</span> and <span style="color: blue">DESCRIPTION</span> where they are missing:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="at">bites =</span> VALUE, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> <span class="at">NAME =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># DESCRIPTION</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> <span class="at">mu_M =</span> VALUE <span class="co"># DESCRIPTION</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need to specify the start time and end time for our simulation, as well as the time step to report values. We will use the times specified in the Ndii et al.&nbsp;paper. Copy and paste the code chunk below into your editor, and complete by specifying the arguments to the <code>seq</code>function, indicated as <span style="color: blue">VALUE, VALUE, VALUE</span> using a time step of 1 day:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-31"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(VALUE, VALUE, VALUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-up-the-initial-conditions" class="level3">
<h3 class="anchored" data-anchor-id="set-up-the-initial-conditions">Set up the initial conditions</h3>
<p>The Ndii et al.&nbsp;paper develops a model for dengue transmission in the city of Cairns, Australia, which had an approximate human population of 150,000 in 2008. The carrying capacity for the mosquito population (the maximum population that can be supported without environmental degradation) is related to the number of available breeding sites, which in turn is dependent on the number of humans. The Ndii et al paper sets the carrying capacity at three times the human population, and so we will assume an initial mosquito population size of 450,000, half of which is female. We only model female mosquitoes as they are the only ones that transmit infection. Our simulations will commence with 2 infectious humans and 10 infectious mosquitoes, with all remaining humans and mosquitoes susceptible.</p>
<p>Using this information, copy and paste the following code chunk into your editor and complete the code by entering <span style="color: blue">VALUE</span> where it is missing, and calculating the population in the human recovered compartment and mosquito infectious compartment using the values of other variables (where <span style="color: blue">EXPRESSION USING OTHER VARIABLES</span> is indicated):</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> VALUE <span class="co"># population of Cairns in 2008</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> VALUE</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> VALUE</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-the-model-variables-also-known-as-compartments-or-states" class="level3">
<h3 class="anchored" data-anchor-id="define-the-model-variables-also-known-as-compartments-or-states">Define the model variables (also known as compartments or states)</h3>
<p>We define the compartments of our model, initialise the value of each using the initial conditions and then gather them together in a single variable. Copy and paste the code chunk below into your editor and complete the code by entering <span style="color: blue">VALUE</span> where it is missing:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the system and set to initial values</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> VALUE,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> VALUE,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> VALUE,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> VALUE,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> VALUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-up-a-function-to-solve-the-equations" class="level3">
<h3 class="anchored" data-anchor-id="set-up-a-function-to-solve-the-equations">Set up a function to solve the equations</h3>
<p>Now that we have defined our parameters, compartments and initial conditions, we will write a function to numerically solve our dengue model using the model equations developed in the previous session. Copy and paste the incomplete code chunk below into your editor and complete the code by replacing the text indicated by <span style="color: blue">EXPRESSION USING OTHER VARIABLES</span>:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dengue_base <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="run-the-model-and-plot-the-results" class="level3">
<h3 class="anchored" data-anchor-id="run-the-model-and-plot-the-results">Run the model and plot the results</h3>
<p>We now run the model, using the code you learned in a previous session. Copy and paste the code chunk below into your editor, enter <span style="color: blue">VALUE</span> where it is missing, and then run your file:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>out_dengue_base <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> VALUE, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">func =</span> VALUE, <span class="at">parms =</span> VALUE)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_base, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your plot should look this this:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session8_vector_borne_modelling_in_r_files/figure-html/run_model-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparing-to-published-dengue-incidence-data" class="level3">
<h3 class="anchored" data-anchor-id="comparing-to-published-dengue-incidence-data">Comparing to published dengue incidence data</h3>
<p>The weekly incidence of dengue infections in Cairns over the period we ran our model is reported in Ritchie, S.A., Pyke, A.T., Hall-Mendelin, S.et al., 2013. An explosive epidemic of DENV-3 in Cairns, Australia. <em>PLoS One</em>, 8(7), p.e68137.</p>
<div class="row">
<center>
<img src="pone.0068137.g002.png" alt="Dengue confirmed cases in Cairns Nov 2008 to May 2009" style="width:80%">
</center>
</div>
<p>The data in this published plot represent the weekly number of newly confirmed cases, while the model output we have saved reports the daily number of infectious people. To compare our data to the published data, we need to convert our data into new infections, that is, convert <em>prevalence</em> data into <em>incidence</em> data. It is possible to save and report new infections directly within your model function, but here we will calculate the number of new infections using the data we have already generated. From our model equations, we have:</p>
<ul>
<li>
Susceptible human change = - new infections
</li>
</ul>
<p>If we can calculate susceptible human change from our model output, we will have the number of new infections. Since our model output records the number of humans in the S compartment at each of our recorded time steps, if we take the difference between these entries, we will have the susceptible human change, and we get the new infections by changing its sign. Copy and paste the code below into your editor, to convert daily prevalence into weekly incidence and plot the results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_base[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Susceptible_human"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> dengue_base_infections <span class="ot">&lt;-</span> dengue_base_infections  <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">Susceptible_human_change =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Susceptible_human)),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(Susceptible_human_change)) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_base_infections<span class="sc">$</span>time, dengue_base_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session8_vector_borne_modelling_in_r_files/figure-html/new_infections-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Comparing this plot to the published data, we can see that while we have captured the <em>shape</em> of the outbreak reasonably well, our model generates orders of magnitude higher new infections than were reported. There are numerous potential explanations for this. In the next section, we will adapt our model to see whether we can improve the fit.</p>
<p>
<br>
</p>
<p><input type="button" value="Print this page" onclick="window.print()"></p>
</section>
</section>
<section id="part-1-solutions" class="level2">
<h2 class="anchored" data-anchor-id="part-1-solutions"><strong>Part 1:</strong> Solutions</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><strong>Part 1:</strong> Spoiler alert</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><strong>Part 1:</strong> Solutions for Part 1</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The solutions tab contains the complete code for Part 1. <strong>Only click on it if you have tried to complete the exercises yourself and need some help</strong></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>By the end of Part 1, your script should look like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 1##</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 1</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a simple model of dengue. Results are then plotted.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Library imports</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> (<span class="fu">c</span>(<span class="st">"dplyr"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"deSolve"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"ggplot2"</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># Probability of transmission - human to mosquito </span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span> <span class="co"># Mosquito birth and death rate</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-31"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">224990</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>dengue_base <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> (force_of_infection_on_mosquito <span class="sc">+</span> mu_M) <span class="sc">*</span> Susceptible_mosquito </span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> mu_M <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>out_dengue_base <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_base, <span class="at">parms =</span> parameters)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_base, </span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_base[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Susceptible_human"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> dengue_base_infections  <span class="sc">%&gt;%</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Susceptible_human_change =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Susceptible_human)),</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(Susceptible_human_change)) <span class="sc">%&gt;%</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))    </span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_base_infections<span class="sc">$</span>time, dengue_base_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="part-2-adapting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="part-2-adapting-the-model"><strong>Part 2:</strong> Adapting the model</h2>
<p>In this part, we will adapt the model we developed in Part 1 to try to better capture the Cairns dengue outbreak dynamics. It is important to note that our model in Part 1 mostly used parameter values from Ndii et al.&nbsp;Two of those parameters, the probability of transmission from mosquito to human (T_HM) and the probability of transmission from human to mosquito (T_MH) were <strong>fitted</strong> using the Ndii et al.&nbsp;model, which has a different structure to the model we developed in Part 1.This highlights the very important point that:</p>
<center>
<span style="font-size:16pt; color: red"><em>Parameter values may not be directly transferable between models</em></span>
</center>
<section id="what-might-be-missing-from-our-dengue-model" class="level3">
<h3 class="anchored" data-anchor-id="what-might-be-missing-from-our-dengue-model">What might be missing from our dengue model?</h3>
<p>When we wrote our vector-borne disease model, we made a simplifying assumption that both humans and mosquitoes are infectious immediately upon being infected. We noted that in reality, it takes time for the infectious load to build in a host before they are capable of transmitting infection. As you have seen in previous sessions, we refer to this as the exposed period — an individual is infected, but not yet infectious. Ndii et al.&nbsp;account for this in their model.</p>
<p><strong>2.1 Ndii et al.&nbsp;use 10 days as the duration of the exposed period in mosquitoes. With mosquitoes living on average for 14 days, what do you think are the implications of this exposed period for transmission?</strong></p>
<textarea cols="127" rows="4"></textarea>
<p>
<br>
</p>
<p><strong>2.2 Ndii et al.&nbsp;use 5.5 days as the duration of the exposed period in humans. Which exposed period (mosquito or human) do you think would have a greater impact on dengue disease dynamics? Why?</strong></p>
<textarea cols="127" rows="4"></textarea>
</section>
<section id="adding-another-compartment-to-our-model-diagram" class="level3">
<h3 class="anchored" data-anchor-id="adding-another-compartment-to-our-model-diagram">Adding another compartment to our model diagram</h3>
<p>Before we begin coding a new version of our model, it’s a good idea to draw the structure of the new model. Redraw the model that you produced in the previous session to include exposed compartments for both the human and the mosquito populations.</p>
<p>
</p>
<p>
<strong>Instructions:</strong>
</p>
<ol style="list-style-type: decimal">
<li>
<p>
You can draw a diagram electronically in a program such as PowerPoint, or you can draw your diagram by hand and take a photo
</p>
</li>
<li>
<p>
Make sure you label all compartments as well as the inflows and outflows from each compartment.
</p>
</li>
<li>
<p>
Save your diagram in one of the following formats: .jpg, .gif, .png
</p>
</li>
<li>
<p>
Upload your diagram using the <strong><em>Browse…</em></strong> button below
</p>
</li>
<li>
<p>
If you prefer, you can describe your model in words in the space below
</p>
</li>
</ol>
<p>
<strong>NB: You can replace a file by clicking on the file name and selecting a file with a different name.</strong>
</p>
<div class="field" data-align="left">
<p><span></span></p>
<h3 class="anchored">
Upload your image
</h3>
<p>
<input type="file" id="files" name="files[]" multiple=""> 
</p>
</div>
<style>
    input[type="file"] {

     display:block;
    }
    .imageThumb {
     max-height: 600px;
     border: 2px solid;
     margin: 10px 10px 0 0;
     padding: 1px;
     }
</style>
<script type="text/javascript">
    $(document).ready(function() {

     if(window.File && window.FileList && window.FileReader) {
        $("#files").on("change",function(e) {
            var files = e.target.files ,
            filesLength = files.length ;
            for (var i = 0; i < filesLength ; i++) {
                var f = files[i]
                var fileReader = new FileReader();
                fileReader.onload = (function(e) {
                    var file = e.target;
                    $("<span class=\"pip\">" +
            "<img class=\"imageThumb\" src=\"" + e.target.result + "\" title=\"" + file.name + "\"/>" +
            "<br/><span class=\"remove\"><u>Remove image</u></span>" +
            "</span>").insertAfter("#files");
          $(".remove").click(function(){
            $(this).parent(".pip").remove();
          });
                });
               fileReader.readAsDataURL(f);
           }
      });
     } else { alert("Your browser doesn't support to File API") }
    });

</script>
</section>
<section id="adding-another-compartment-to-our-model-code" class="level3">
<h3 class="anchored" data-anchor-id="adding-another-compartment-to-our-model-code">Adding another compartment to our model code</h3>
<p><strong>2.3 To add a new compartment to our model, several aspects need to be changed. What is the additional information that needs to be provided?</strong></p>
<textarea cols="127" rows="4"></textarea>
<p>Before beginning, you should add a heading in your file indicating that you have started a new model, as the code we write here will overwrite the parameters and variables you used in Part 1, other than your final results. For example, you could copy and paste the code chunk below into your editor to start writing your code for the new model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 2##</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 2</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a modified model of dengue. Results are then plotted.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First we need to add new parameters. Copy and paste the code chunk below into your editor, enter <span style="color: blue">VALUE</span> where it is missing, and then run your file:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a> <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a> <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - human to mosquito</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a> <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days. Duration in infectious compartment</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a> <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="co"># per day. Mosquito birth and death rate.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a> <span class="at">exposed_period_H =</span> VALUE, <span class="co"># days. Duration in exposed compartment - human</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a> <span class="at">exposed_period_M =</span> VALUE <span class="co"># days. Duration in exposed compartment - mosquito</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we need to add some new initial conditions. Let’s start with no exposed humans and no exposed mosquitoes. Copy and paste the code chunk below into your editor, completing <span style="color: blue">EXPRESSION USING OTHER VARIABLES</span> where it is missing:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>initial_human_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> <span class="co"># 3 times human population, divided by 2</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">224990</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>initial_mosquito_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> EXPRESSION USING OTHER VARIABLES</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we now initialise our model states, using the initial conditions we set above. Copy and paste the code chunk below into your editor, completing <span style="color: blue">EXPRESSION USING OTHER VARIABLES</span> where it is missing:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># state of the system and set to initial values</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_human =</span> EXPRESSION USING OTHER VARIABLES,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_mosquito =</span> EXPRESSION USING OTHER VARIABLES,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We set up times to run the model, here extending the end date (for reasons that will become clear). Copy and paste the code chunk below into your editor, to continue your code:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2011-05-31"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we adapt our model function to include the changes we have made to the model structure.Copy and paste the code chunk below into your editor to continue your code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dengue_with_E <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      Recovered_human <span class="sc">+</span> Exposed_human</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito <span class="sc">+</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      Exposed_mosquito</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      Total_human_population</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      Total_human_population</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    Exposed_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      Exposed_human <span class="sc">/</span> exposed_period_H</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> Exposed_human <span class="sc">/</span> exposed_period_H <span class="sc">-</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      (force_of_infection_on_mosquito <span class="sc">+</span> mu_M) <span class="sc">*</span> Susceptible_mosquito</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    Exposed_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      Susceptible_mosquito <span class="sc">-</span> Exposed_mosquito <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> exposed_period_M <span class="sc">+</span> mu_M) </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M <span class="sc">*</span> </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>      Infectious_mosquito</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        Exposed_human_change,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        Exposed_mosquito_change,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2.4 Identify the elements of the model function above that have changed compared to your model in Part 1</strong></p>
<textarea cols="127" rows="6"></textarea>
<p>We are now ready to run the model and plot the results. Note that we use a different name for the output to preserve the results from your model in Part 1. Copy and paste the code chunk below into your editor, enter <span style="color: blue">VALUE</span> where it is missing, and then run the new model parts of your file:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>out_dengue_with_E <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> VALUE, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">func =</span> VALUE, <span class="at">parms =</span> VALUE)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_with_E, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Exposed humans"</span>, <span class="st">"Infectious humans"</span>, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Recovered humans"</span>,   <span class="st">"Susceptible mosquitoes"</span>, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Exposed mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your plot should look this this:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session8_vector_borne_modelling_in_r_files/figure-html/run_model_with_E-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As we did in Part 1, we want to convert our dengue prevalence data to incidence data. In our new model, we have:</p>
<ul>
<li>
Susceptible human change = - new infections
</li>
<li>
Exposed human change = new infections - transitions to infectious
</li>
<li>
Infectious human change = transitions to infectious - recoveries
</li>
<li>
Recovered human change = recoveries
</li>
</ul>
<p>As before, we could calculate the difference in our susceptible population from our model output to be left with ‘new infections’ at each time step. However, the new infections in this model may not yet have come to the attention of the health system. We make the simplifying assumption that symptoms occur at the same time that a person becomes infectious, and so we count the transitions into the infectious state as our new ‘cases’ and obtain these by adding the infectious human change and recovered human change. Copy and paste the code below into your editor, to convert daily prevalence into weekly incidence and plot the results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dengue_with_E_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  out_dengue_with_E[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>dengue_with_E_infections <span class="ot">&lt;-</span> dengue_with_E_infections  <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">Infectious_human_change =</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Infectious_human)),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Recovered_human_change =</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Recovered_human)),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">New_human_infections =</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                                   Infectious_human_change <span class="sc">+</span> </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                                   Recovered_human_change,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Cumulative_human_infections =</span> </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">cumsum</span>(New_human_infections)) <span class="sc">%&gt;%</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_with_E_infections<span class="sc">$</span>time, </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>     dengue_with_E_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections, model with E"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session8_vector_borne_modelling_in_r_files/figure-html/new_infections_with_E-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As a reminder, here are the published data from Part 1:</p>
<div class="row">
<center>
<img src="pone.0068137.g002.png" alt="Dengue confirmed cases in Cairns Nov 2008 to May 2009" style="width:80%">
</center>
</div>
<p><strong>2.5 How do the modelled results compare to those for the model in Part 1? (Hint: Look at the magnitude and the timing of the peak.)</strong></p>
<textarea cols="127" rows="6"></textarea>
<p>
<br>
</p>
<p><strong>2.6 Why do you think the modelled behaviour has changed?</strong></p>
<textarea cols="127" rows="6"></textarea>
<p>
<br>
</p>
<p><input type="button" value="Print this page" onclick="window.print()"></p>
</section>
</section>
<section id="part-2-solutions" class="level2">
<h2 class="anchored" data-anchor-id="part-2-solutions"><strong>Part 2:</strong> Solutions</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><strong>Part 2:</strong> Spoiler alert</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><strong>Part 2:</strong> Solutions for Part 2</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>The solutions tab contains the complete code for Parts 1 and 2. <strong>Only click on it if you have tried to complete the exercises yourself and need some help</strong></p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>By the end of Part 2, your script should look like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 1##</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a simple model of dengue. Results are then plotted.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Library imports</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> (<span class="fu">c</span>(<span class="st">"dplyr"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"deSolve"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"ggplot2"</span>))</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># Probability of transmission - human to mosquito </span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span> <span class="co"># Mosquito birth and death rate</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-31"</span>)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">224990</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>dengue_base <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> (force_of_infection_on_mosquito <span class="sc">+</span> mu_M) <span class="sc">*</span> Susceptible_mosquito </span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> mu_M <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>out_dengue_base <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_base, <span class="at">parms =</span> parameters)</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_base, </span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_base[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Susceptible_human"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> dengue_base_infections  <span class="sc">%&gt;%</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Susceptible_human_change =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Susceptible_human)),</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(Susceptible_human_change)) <span class="sc">%&gt;%</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))    </span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_base_infections<span class="sc">$</span>time, dengue_base_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections"</span>)</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 2##</span></span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 2</span></span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a><span class="co"># for a modified model of dengue. Results are then plotted.</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - human to mosquito</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days. Duration in infectious compartment</span></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="co"># per day. Mosquito birth and death rate.</span></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposed_period_H =</span> <span class="fl">5.5</span>, <span class="co"># days. Duration in exposed compartment - human</span></span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposed_period_M =</span> <span class="dv">10</span> <span class="co"># days. Duration in exposed compartment - mosquito</span></span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>initial_human_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious <span class="sc">-</span> initial_human_exposed</span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> <span class="co"># 3 times human population, divided by 2</span></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">224990</span></span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a>initial_mosquito_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible <span class="sc">-</span> initial_mosquito_exposed</span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_human =</span> initial_human_exposed,</span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_mosquito =</span> initial_mosquito_exposed,</span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2011-05-31"</span>)</span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a>dengue_with_E <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human <span class="sc">+</span> Exposed_human</span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito <span class="sc">+</span> Exposed_mosquito</span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a>    Exposed_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Exposed_human <span class="sc">/</span> exposed_period_H</span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> Exposed_human <span class="sc">/</span> exposed_period_H <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> (force_of_infection_on_mosquito <span class="sc">+</span> mu_M) <span class="sc">*</span> Susceptible_mosquito</span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a>    Exposed_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> Exposed_mosquito <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> exposed_period_M <span class="sc">+</span> mu_M) </span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a>        Exposed_human_change,</span>
<span id="cb19-182"><a href="#cb19-182" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb19-183"><a href="#cb19-183" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb19-184"><a href="#cb19-184" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb19-185"><a href="#cb19-185" aria-hidden="true" tabindex="-1"></a>        Exposed_mosquito_change,</span>
<span id="cb19-186"><a href="#cb19-186" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb19-187"><a href="#cb19-187" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb19-188"><a href="#cb19-188" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb19-189"><a href="#cb19-189" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-190"><a href="#cb19-190" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-191"><a href="#cb19-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-192"><a href="#cb19-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb19-193"><a href="#cb19-193" aria-hidden="true" tabindex="-1"></a>out_dengue_with_E <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_with_E, <span class="at">parms =</span> parameters)</span>
<span id="cb19-194"><a href="#cb19-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-195"><a href="#cb19-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb19-196"><a href="#cb19-196" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_with_E, </span>
<span id="cb19-197"><a href="#cb19-197" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Exposed humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb19-198"><a href="#cb19-198" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Exposed mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb19-199"><a href="#cb19-199" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span>
<span id="cb19-200"><a href="#cb19-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-201"><a href="#cb19-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb19-202"><a href="#cb19-202" aria-hidden="true" tabindex="-1"></a>dengue_with_E_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_with_E[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb19-203"><a href="#cb19-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-204"><a href="#cb19-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb19-205"><a href="#cb19-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb19-206"><a href="#cb19-206" aria-hidden="true" tabindex="-1"></a>dengue_with_E_infections <span class="ot">&lt;-</span> dengue_with_E_infections  <span class="sc">%&gt;%</span></span>
<span id="cb19-207"><a href="#cb19-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Infectious_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Infectious_human)),</span>
<span id="cb19-208"><a href="#cb19-208" aria-hidden="true" tabindex="-1"></a>         <span class="at">Recovered_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Recovered_human)),</span>
<span id="cb19-209"><a href="#cb19-209" aria-hidden="true" tabindex="-1"></a>         <span class="at">New_human_infections =</span> Infectious_human_change <span class="sc">+</span> Recovered_human_change,</span>
<span id="cb19-210"><a href="#cb19-210" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(New_human_infections)) <span class="sc">%&gt;%</span></span>
<span id="cb19-211"><a href="#cb19-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-212"><a href="#cb19-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-213"><a href="#cb19-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))</span>
<span id="cb19-214"><a href="#cb19-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-215"><a href="#cb19-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb19-216"><a href="#cb19-216" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_with_E_infections<span class="sc">$</span>time, dengue_with_E_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb19-217"><a href="#cb19-217" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb19-218"><a href="#cb19-218" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections, model with E"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="part-3-the-impact-of-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="part-3-the-impact-of-seasonality"><strong>Part 3:</strong> The impact of seasonality</h2>
<section id="adding-seasonality-to-the-model" class="level3">
<h3 class="anchored" data-anchor-id="adding-seasonality-to-the-model">Adding seasonality to the model</h3>
<p>Adding an exposed compartment reduced the number of new infections, but substantially delayed the timing of the outbreak. There is still a large assumption that we have made — that the mosquito population is constant. In tropical areas, mosquito numbers fluctuate substantially over the year, with larger numbers typically seen in the wet season, which in Cairns develops in December and lasts until March. Ndii et al. incorporated such seasonality in the mosquito death rate in their model. We apply a seasonal death rate for mosquitoes using the parameters and formula applied by Ndii et al:</p>
<p><span class="math display">\[death\text{ }rate(t) = average\text{ }death\text{ }rate\left(1 - amplitude * \text{cos}\left(\frac{2\pi*\left(t + phase\right)}{365}\right)\right)\]</span></p>
<p>As before, you should add a heading in your file indicating that you have started a new model. For example, you could copy and paste the code chunk below into your editor to start writing your code for the new model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 3##</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 3</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a model of dengue with an exposed period and seasonality. </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Results are then plotted.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First we need to define the new seasonality parameters. Copy and paste the code chunk below into your editor to continue writing your code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add seasonality parameters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a> <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a> <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a> <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - human to mosquito</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a> <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days. Duration in infectious compartment</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a> <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="co"># per day. Mosquito birth and death rate.</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a> <span class="at">exposed_period_H =</span> <span class="fl">5.5</span>, <span class="co"># days. Duration in exposed compartment - human</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a> <span class="at">exposed_period_M =</span> <span class="dv">10</span>, <span class="co"># days. Duration in exposed compartment - mosquito</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a> <span class="at">death_amplitude =</span> <span class="fl">0.6228</span>, <span class="co"># from Ndii et al.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a> <span class="at">death_phase =</span> <span class="fl">20.61</span> <span class="co"># days, from Ndii et al.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>3.1 What effect do you expect a seasonal death rate to have on the size of the mosquito population?</strong></p>
<textarea cols="127" rows="6"></textarea>
<p>As well as the parameters, we also need to change our initial population numbers to reflect that when our model starts in November, the mosquito population is not at its maximum value. Copy and paste the code chunk below into your editor to define the new initial conditions and initialise the compartments:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>initial_human_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious <span class="sc">-</span> initial_human_exposed</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">110000</span> <span class="co"># around half the maximum</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">109990</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>initial_mosquito_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible <span class="sc">-</span> initial_mosquito_exposed</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_human =</span> initial_human_exposed,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_mosquito =</span> initial_mosquito_exposed,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We set up times to run the model, returning to our original dates. Copy and paste the code chunk below into your editor, to continue your code:</p>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-31"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we adapt our model function to add seasonality to the mosquito death rate.Copy and paste the code chunk below into your editor to continue your code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function with seasonality</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>dengue_with_E_seasonal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human <span class="sc">+</span> Exposed_human</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito <span class="sc">+</span> Exposed_mosquito</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the current seasonal death rate</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    mu_M_seasonal <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> death_amplitude <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> (t <span class="sc">+</span> death_phase) <span class="sc">/</span> <span class="dv">365</span>))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    Exposed_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Exposed_human <span class="sc">/</span> exposed_period_H</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> Exposed_human <span class="sc">/</span> exposed_period_H <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> mu_M_seasonal <span class="sc">*</span> Susceptible_mosquito</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    Exposed_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M_seasonal <span class="sc">*</span> Exposed_mosquito </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M_seasonal <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        Exposed_human_change,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>        Exposed_mosquito_change,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are now ready to run the model and plot the results. Again we use a different name for the output to preserve the results from your model in Parts 1 and 2. Copy and paste the code chunk below into your editor and then run the new model parts of your file:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>out_dengue_with_E_seasonal <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_with_E_seasonal, <span class="at">parms =</span> parameters)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_with_E_seasonal, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Exposed humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Exposed mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your plot should look this this:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session8_vector_borne_modelling_in_r_files/figure-html/run_model_with_E_seasonal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Copy and paste the code below into your editor, to convert daily prevalence into weekly incidence and plot the results:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dengue_with_E_seasonal_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_with_E_seasonal[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>dengue_with_E_seasonal_infections <span class="ot">&lt;-</span> dengue_with_E_seasonal_infections  <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">Infectious_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Infectious_human)),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Recovered_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Recovered_human)),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">New_human_infections =</span> Infectious_human_change <span class="sc">+</span> Recovered_human_change,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(New_human_infections)) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_with_E_seasonal_infections<span class="sc">$</span>time, dengue_with_E_seasonal_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections, model with E and seasonality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session8_vector_borne_modelling_in_r_files/figure-html/new_infections_with_E_seasonal_infectious-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As a reminder, here are the published data from Part 1:</p>
<div class="row">
<center>
<img src="pone.0068137.g002.png" alt="Dengue confirmed cases in Cairns Nov 2008 to May 2009" style="width:80%">
</center>
</div>
<p>
<br>
</p>
<p><strong>3.2 How do the results compare to the case data in Part 1? What might be the explanation for any differences?</strong></p>
<textarea cols="127" rows="6"></textarea>
<p>
<br>
</p>
<p><input type="button" value="Print this page" onclick="window.print()"></p>
</section>
</section>
<section id="part-3-solutions" class="level2">
<h2 class="anchored" data-anchor-id="part-3-solutions"><strong>Part 3:</strong> Solutions</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true"><strong>Part 3:</strong> Spoiler alert</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><strong>Part 3:</strong> Solutions for Part 3</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>The solutions tab contains the complete code for Parts 1, 2 and 3. <strong>Only click on it if you have tried to complete the exercises yourself and need some help</strong></p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>By the end of Part 3, your script should look like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 1##</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 1</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a simple model of dengue. Results are then plotted.</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Library imports</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> (<span class="fu">c</span>(<span class="st">"dplyr"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"deSolve"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"ggplot2"</span>))</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># Probability of transmission - human to mosquito </span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span> <span class="co"># Mosquito birth and death rate</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-31"</span>)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> </span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">224990</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>dengue_base <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> (force_of_infection_on_mosquito <span class="sc">+</span> mu_M) <span class="sc">*</span> Susceptible_mosquito </span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> mu_M <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>out_dengue_base <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_base, <span class="at">parms =</span> parameters)</span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_base, </span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_base[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Susceptible_human"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>dengue_base_infections <span class="ot">&lt;-</span> dengue_base_infections  <span class="sc">%&gt;%</span></span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Susceptible_human_change =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Susceptible_human)),</span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(Susceptible_human_change)) <span class="sc">%&gt;%</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))    </span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_base_infections<span class="sc">$</span>time, dengue_base_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections"</span>)</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 2##</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 2</span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a><span class="co"># for a modified model of dengue. Results are then plotted.</span></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Model parameters</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - human to mosquito</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days. Duration in infectious compartment</span></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="co"># per day. Mosquito birth and death rate.</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposed_period_H =</span> <span class="fl">5.5</span>, <span class="co"># days. Duration in exposed compartment - human</span></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposed_period_M =</span> <span class="dv">10</span> <span class="co"># days. Duration in exposed compartment - mosquito</span></span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>initial_human_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious <span class="sc">-</span> initial_human_exposed</span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">225000</span> <span class="co"># 3 times human population, divided by 2</span></span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">224990</span></span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a>initial_mosquito_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible <span class="sc">-</span> initial_mosquito_exposed</span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_human =</span> initial_human_exposed,</span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_mosquito =</span> initial_mosquito_exposed,</span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2011-05-31"</span>)</span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function</span></span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>dengue_with_E <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human <span class="sc">+</span> Exposed_human</span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito <span class="sc">+</span> Exposed_mosquito</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a>    Exposed_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Exposed_human <span class="sc">/</span> exposed_period_H</span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> Exposed_human <span class="sc">/</span> exposed_period_H <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> (force_of_infection_on_mosquito <span class="sc">+</span> mu_M) <span class="sc">*</span> Susceptible_mosquito</span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a>    Exposed_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> Exposed_mosquito <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> exposed_period_M <span class="sc">+</span> mu_M) </span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a>        Exposed_human_change,</span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a>        Exposed_mosquito_change,</span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a>out_dengue_with_E <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_with_E, <span class="at">parms =</span> parameters)</span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_with_E, </span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Exposed humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Exposed mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a>dengue_with_E_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_with_E[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a>dengue_with_E_infections <span class="ot">&lt;-</span> dengue_with_E_infections  <span class="sc">%&gt;%</span></span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Infectious_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Infectious_human)),</span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a>         <span class="at">Recovered_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Recovered_human)),</span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a>         <span class="at">New_human_infections =</span> Infectious_human_change <span class="sc">+</span> Recovered_human_change,</span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(New_human_infections)) <span class="sc">%&gt;%</span></span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))</span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_with_E_infections<span class="sc">$</span>time, dengue_with_E_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections, model with E"</span>)</span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a><span class="do">## MODELLING VECTOR-BORNE DISEASES PRACTICAL SESSION PART 3##</span></span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################</span></span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a><span class="co"># A model for dengue transmission - Part 3</span></span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Some R code to numerically solve a set of ordinary differential equations</span></span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a><span class="co"># for a model of dengue with an exposed period and seasonality. </span></span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Results are then plotted.</span></span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Add seasonality parameters</span></span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a>  <span class="at">bites =</span> <span class="fl">0.63</span>, <span class="co"># number of bites per mosquito per day</span></span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_HM =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - mosquito to human</span></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">T_MH =</span> <span class="fl">0.26</span>, <span class="co"># probability of transmission - human to mosquito</span></span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">infectious_period =</span> <span class="dv">5</span>, <span class="co"># days. Duration in infectious compartment</span></span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_M =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="co"># per day. Mosquito birth and death rate.</span></span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposed_period_H =</span> <span class="fl">5.5</span>, <span class="co"># days. Duration in exposed compartment - human</span></span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposed_period_M =</span> <span class="dv">10</span>, <span class="co"># days. Duration in exposed compartment - mosquito</span></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a>  <span class="at">death_amplitude =</span> <span class="fl">0.6228</span>, <span class="co"># from Ndii et al.</span></span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a>  <span class="at">death_phase =</span> <span class="fl">20.61</span> <span class="co"># days, from Ndii et al.</span></span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a>human_population <span class="ot">&lt;-</span> <span class="dv">150000</span> <span class="co"># population of Cairns in 2008</span></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a>initial_human_susceptible <span class="ot">&lt;-</span> <span class="dv">149998</span></span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a>initial_human_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a>initial_human_infectious <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a>initial_human_recovered <span class="ot">&lt;-</span> human_population <span class="sc">-</span> initial_human_susceptible <span class="sc">-</span> initial_human_infectious <span class="sc">-</span> initial_human_exposed</span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a>mosquito_population <span class="ot">&lt;-</span> <span class="dv">110000</span> <span class="co"># around half the maximum</span></span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a>initial_mosquito_susceptible <span class="ot">&lt;-</span> <span class="dv">109990</span></span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a>initial_mosquito_exposed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a>initial_mosquito_infectious <span class="ot">&lt;-</span> mosquito_population <span class="sc">-</span> initial_mosquito_susceptible <span class="sc">-</span> initial_mosquito_exposed</span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model compartments, gather into a single variable to capture the state of the system and set to initial values</span></span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Susceptible_human =</span> initial_human_susceptible,</span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_human =</span> initial_human_exposed,</span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_human =</span> initial_human_infectious,</span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a>           <span class="at">Recovered_human =</span> initial_human_recovered,</span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a>           <span class="at">Susceptible_mosquito =</span> initial_mosquito_susceptible,</span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a>           <span class="at">Exposed_mosquito =</span> initial_mosquito_exposed,</span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a>           <span class="at">Infectious_mosquito =</span> initial_mosquito_infectious)</span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Time window</span></span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2008-11-02"</span>)</span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2009-05-31"</span>)</span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a>times <span class="ot">=</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Model function with seasonality</span></span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a>dengue_with_E_seasonal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, parameters){</span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total population sizes</span></span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a>    Total_human_population <span class="ot">&lt;-</span> Susceptible_human <span class="sc">+</span> Infectious_human <span class="sc">+</span> Recovered_human <span class="sc">+</span> Exposed_human</span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a>    Total_mosquito_population <span class="ot">&lt;-</span> Susceptible_mosquito <span class="sc">+</span> Infectious_mosquito <span class="sc">+</span> Exposed_mosquito</span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible human</span></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_human <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_HM <span class="sc">*</span> Infectious_mosquito <span class="sc">/</span> Total_human_population</span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the average force of infection imposed on each susceptible mosquito</span></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a>    force_of_infection_on_mosquito <span class="ot">&lt;-</span> bites <span class="sc">*</span> T_MH <span class="sc">*</span> Infectious_human <span class="sc">/</span> Total_human_population</span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the current seasonal death rate</span></span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a>    mu_M_seasonal <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> death_amplitude <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> (t <span class="sc">+</span> death_phase) <span class="sc">/</span> <span class="dv">365</span>))</span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the (net) instantaneous change in each compartment</span></span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a>    Susceptible_human_change <span class="ot">&lt;-</span> <span class="sc">-</span>force_of_infection_on_human <span class="sc">*</span> Susceptible_human</span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a>    Exposed_human_change <span class="ot">&lt;-</span> force_of_infection_on_human <span class="sc">*</span> Susceptible_human <span class="sc">-</span> Exposed_human <span class="sc">/</span> exposed_period_H</span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a>    Infectious_human_change <span class="ot">&lt;-</span> Exposed_human <span class="sc">/</span> exposed_period_H <span class="sc">-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a>    Recovered_human_change <span class="ot">&lt;-</span> Infectious_human <span class="sc">/</span> infectious_period</span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a>    Susceptible_mosquito_change <span class="ot">&lt;-</span> mu_M <span class="sc">*</span> Total_mosquito_population <span class="sc">-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> mu_M_seasonal <span class="sc">*</span> Susceptible_mosquito</span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>    Exposed_mosquito_change <span class="ot">&lt;-</span> force_of_infection_on_mosquito <span class="sc">*</span> Susceptible_mosquito <span class="sc">-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M_seasonal <span class="sc">*</span> Exposed_mosquito </span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>    Infectious_mosquito_change <span class="ot">&lt;-</span> Exposed_mosquito <span class="sc">/</span> exposed_period_M <span class="sc">-</span> mu_M_seasonal <span class="sc">*</span> Infectious_mosquito</span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return net changes as list</span></span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a>        Susceptible_human_change,</span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a>        Exposed_human_change,</span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a>        Infectious_human_change,</span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a>        Recovered_human_change,</span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a>        Susceptible_mosquito_change,</span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a>        Exposed_mosquito_change,</span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a>        Infectious_mosquito_change</span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve model</span></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a>out_dengue_with_E_seasonal <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> state, <span class="at">times =</span> <span class="fu">as.numeric</span>(times <span class="sc">-</span> times[<span class="dv">1</span>]), <span class="at">func =</span> dengue_with_E_seasonal, <span class="at">parms =</span> parameters)</span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out_dengue_with_E_seasonal, </span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">c</span>(<span class="st">"Susceptible humans"</span>, <span class="st">"Exposed humans"</span>, <span class="st">"Infectious humans"</span>, <span class="st">"Recovered humans"</span>,</span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Susceptible mosquitoes"</span>, <span class="st">"Exposed mosquitoes"</span>, <span class="st">"Infectious mosquitoes"</span>), </span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"population size"</span>))</span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ode output to data frame</span></span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a>dengue_with_E_seasonal_infections <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out_dengue_with_E_seasonal[, <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Infectious_human"</span>, <span class="st">"Recovered_human"</span>)])</span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for new infections and cumulative new infections, </span></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Select every 7th row and calculate the difference</span></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a>dengue_with_E_seasonal_infections <span class="ot">&lt;-</span> dengue_with_E_seasonal_infections  <span class="sc">%&gt;%</span></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Infectious_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Infectious_human)),</span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a>         <span class="at">Recovered_human_change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Recovered_human)),</span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a>         <span class="at">New_human_infections =</span> Infectious_human_change <span class="sc">+</span> Recovered_human_change,</span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cumulative_human_infections =</span> <span class="fu">cumsum</span>(New_human_infections)) <span class="sc">%&gt;%</span></span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%%</span> <span class="dv">7</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"Cumulative_human_infections"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekly_human_infections =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(Cumulative_human_infections)))</span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot solution</span></span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dengue_with_E_seasonal_infections<span class="sc">$</span>time, dengue_with_E_seasonal_infections<span class="sc">$</span>Weekly_human_infections, </span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"number of infections"</span>),</span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Weekly human new infections, model with E and seasonality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="part-4-interventions" class="level2">
<h2 class="anchored" data-anchor-id="part-4-interventions"><strong>Part 4:</strong> Interventions</h2>
<section id="interventions-to-control-dengue" class="level3">
<h3 class="anchored" data-anchor-id="interventions-to-control-dengue">Interventions to control dengue</h3>
<p>Interventions against vector-borne diseases can take a number of different forms, because they can target the host (humans in the dengue model we have considered here) or the vector (mosquitoes in our dengue model). Interventions can also act at different stages of the vector life-cycle, for example, spraying to kill mosquito eggs before they hatch.</p>
<p>In groups of 4–6, identify interventions that could be implemented to control dengue transmission and for each of them, consider what action that intervention would have (for example, does it reduce human susceptibility to infection?). Then discuss how the model we have developed would need to be adapted to include the intervention.</p>
<p>For those wanting an extension activity, adapt the model developed in Part 3 to include these interventions, one at a time, and plot the results.</p>
<p><strong>4.1 Intervention 1: note the type of intervention, how it acts and how our model could be adapted to include it.</strong></p>
<textarea cols="127" rows="8"></textarea>
<p>
<br>
</p>
<p><strong>4.2 Intervention 2: note the type of intervention, how it acts and how our model could be adapted to include it.</strong></p>
<textarea cols="127" rows="8"></textarea>
<p>
<br>
</p>
<p><strong>4.3 Intervention 3: note the type of intervention, how it acts and how our model could be adapted to include it.</strong></p>
<textarea cols="127" rows="8"></textarea>
<p>
<br>
</p>
<p><input type="button" value="Print this page" onclick="window.print()"></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>